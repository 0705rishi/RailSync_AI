{% extends "base.html" %}

{% block content %}
<!-- Metrics Dashboard -->
<div class="row mb-4">
    <div class="col-md-2">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6>Active Trains</h6>
                        <h3 id="total-trains">-</h3>
                    </div>
                    <i class="fas fa-train fa-2x"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6>Conflicts</h6>
                        <h3 id="active-conflicts">-</h3>
                    </div>
                    <i class="fas fa-exclamation-triangle fa-2x"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="card bg-info text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6>Avg Delay</h6>
                        <h3 id="average-delay">-</h3>
                    </div>
                    <i class="fas fa-clock fa-2x"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="card bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6>Efficiency</h6>
                        <h3 id="system-efficiency">-</h3>
                    </div>
                    <i class="fas fa-tachometer-alt fa-2x"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="card bg-secondary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6>Throughput</h6>
                        <h3 id="throughput-today">-</h3>
                    </div>
                    <i class="fas fa-chart-line fa-2x"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-2">
        <div class="card bg-dark text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between">
                    <div>
                        <h6>AI Success</h6>
                        <h3 id="ai-success-rate">-</h3>
                    </div>
                    <i class="fas fa-robot fa-2x"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Mumbai Metro Map Visualization Panel -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-map-marked-alt"></i> Mumbai Metro Live Train Tracking</h5>
                <div>
                    <button class="btn btn-sm btn-primary" onclick="refreshMetroMap()">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                    <button class="btn btn-sm btn-success" onclick="startAnimation()">
                        <i class="fas fa-play"></i> Start Animation
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="stopAnimation()">
                        <i class="fas fa-stop"></i> Stop
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div id="metro-container" style="overflow: auto; background: #f8f9fa;">
                    <svg id="mumbai-metro-map" width="1000" height="600" style="background: linear-gradient(135deg, #e3f2fd, #f1f8e9);"></svg>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Train Status Panel -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-list"></i> Train Status</h5>
                <button class="btn btn-sm btn-primary" onclick="refreshTrains()">
                    <i class="fas fa-sync"></i> Refresh
                </button>
            </div>
            <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                <div id="train-list">
                    <!-- Train data will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Conflict Alerts Panel -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-exclamation-circle"></i> Conflict Alerts</h5>
                <button class="btn btn-sm btn-warning" onclick="detectConflicts()">
                    <i class="fas fa-search"></i> Detect
                </button>
            </div>
            <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                <div id="conflict-list">
                    <!-- Conflict data will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- AI Recommendations Panel -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-brain"></i> AI Recommendations</h5>
                <button class="btn btn-sm btn-success" onclick="runOptimization()">
                    <i class="fas fa-cogs"></i> Optimize
                </button>
            </div>
            <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                <div id="recommendations">
                    <div class="text-muted text-center">
                        Click "Optimize" to get AI recommendations
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- What-If Scenario Panel -->
<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="fas fa-flask"></i> What-If Scenario Simulator</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="scenario-name" placeholder="Scenario Name">
                    </div>
                    <div class="col-md-4">
                        <select class="form-control" id="scenario-type">
                            <option>Emergency Stop</option>
                            <option>Weather Delay</option>
                            <option>Track Maintenance</option>
                            <option>Peak Hour Rush</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-info" onclick="runScenario()">
                            <i class="fas fa-play"></i> Run Scenario
                        </button>
                    </div>
                </div>
                <div id="scenario-results" class="mt-3"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>